---
title: 数据在堆栈分配和读取性能差异
date: "2024-4-6"
description: 很多人可能会觉得栈的性能肯定比堆高，其实未必。
tags: ["system"]
---

#数据在堆栈分配和读取性能差异
#### [堆栈的性能](https://course.rs/advance/smart-pointer/box.html#%E5%A0%86%E6%A0%88%E7%9A%84%E6%80%A7%E8%83%BD)

很多人可能会觉得栈的性能肯定比堆高，其实未必。 由于我们在后面的性能专题会专门讲解堆栈的性能问题，因此这里就大概给出结论：

- 小型数据，在栈上的分配性能和读取性能都要比堆上高
- 中型数据，栈上分配性能高，但是读取性能和堆上并无区别，因为无法利用寄存器或 CPU 高速缓存，最终还是要经过一次内存寻址
- 大型数据，只建议在堆上分配和使用

总之，栈的分配速度肯定比堆上快，但是读取速度往往取决于你的数据能不能放入寄存器或 CPU 高速缓存。 因此不要仅仅因为堆上性能不如栈这个印象，就总是优先选择栈，导致代码更复杂的实现。